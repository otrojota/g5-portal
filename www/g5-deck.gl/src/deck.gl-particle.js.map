{"version":3,"file":"deck.gl-particle.js","sources":["../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/superPropBase.js","../node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../src/utils/geodesy.js","../src/utils/bounds.js","../src/utils/viewport.js","../src/particle-layer-update-transform.vs.glsl.js","../src/particle-layer.js"],"sourcesContent":["function _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nexport { _classCallCheck as default };","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nexport { _createClass as default };","function _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nexport { _assertThisInitialized as default };","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return assertThisInitialized(t);\n}\nexport { _possibleConstructorReturn as default };","function _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nexport { _getPrototypeOf as default };","import getPrototypeOf from \"./getPrototypeOf.js\";\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = getPrototypeOf(t)););\n  return t;\n}\nexport { _superPropBase as default };","import superPropBase from \"./superPropBase.js\";\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nexport { _get as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && setPrototypeOf(t, e);\n}\nexport { _inherits as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nexport { _arrayLikeToArray as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return arrayLikeToArray(r);\n}\nexport { _arrayWithoutHoles as default };","function _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nexport { _iterableToArray as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nexport { _unsupportedIterableToArray as default };","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _nonIterableSpread as default };","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nfunction _toConsumableArray(r) {\n  return arrayWithoutHoles(r) || iterableToArray(r) || unsupportedIterableToArray(r) || nonIterableSpread();\n}\nexport { _toConsumableArray as default };","/*\n * Copyright (c) 2021-2023 WeatherLayers.com\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\nimport {distance as geodesyDistance} from 'geodesy-fn/src/spherical.js';\n\n// radius used by deck.gl, see https://github.com/visgl/deck.gl/blob/master/modules/core/src/viewports/globe-viewport.js#L10\nexport const DEFAULT_RADIUS = 6370972;\n\nexport function distance(start, destination) {\n  return geodesyDistance(start, destination, DEFAULT_RADIUS);\n}","/*\n * Copyright (c) 2021-2023 WeatherLayers.com\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/**\n * see https://stackoverflow.com/a/4467559/1823988\n * @param {number} x\n * @param {number} y\n * @returns {number}\n */\nfunction mod(x, y) {\n  return ((x % y) + y) % y;\n}\n\n/**\n * @param {number} lng\n * @param {number} [minLng]\n * @returns {number}\n */\nexport function wrapLongitude(lng, minLng = undefined) {\n  let wrappedLng = mod(lng + 180, 360) - 180;\n  if (typeof minLng === 'number' && wrappedLng < minLng) {\n    wrappedLng += 360;\n  }\n  return wrappedLng;\n}\n\n/**\n * @param {GeoJSON.BBox} bounds\n * @returns {GeoJSON.BBox}\n */\nexport function wrapBounds(bounds) {\n  // wrap longitude\n  const minLng = bounds[2] - bounds[0] < 360 ? wrapLongitude(bounds[0]) : -180;\n  const maxLng = bounds[2] - bounds[0] < 360 ? wrapLongitude(bounds[2], minLng) : 180;\n  // clip latitude\n  const minLat = Math.max(bounds[1], -85.051129);\n  const maxLat = Math.min(bounds[3], 85.051129);\n\n  const mercatorBounds = /** @type {GeoJSON.BBox} */ ([minLng, minLat, maxLng, maxLat]);\n  return mercatorBounds;\n}","/*\n * Copyright (c) 2021-2023 WeatherLayers.com\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\nimport {distance} from './geodesy.js';\nimport {wrapBounds} from './bounds.js';\n\n/** @typedef {any} Viewport */\n\n/**\n * @param {Viewport} viewport \n * @returns {boolean}\n */\nexport function isViewportGlobe(viewport) {\n  return !!viewport.resolution;\n}\n\n/**\n * @param {Viewport} viewport \n * @returns {GeoJSON.Position | null}\n */\nexport function getViewportGlobeCenter(viewport) {\n  if (!isViewportGlobe(viewport)) {\n    return null;\n  }\n\n  return [viewport.longitude, viewport.latitude];\n}\n\n/**\n * @param {Viewport} viewport \n * @returns {number | null}\n */\nexport function getViewportGlobeRadius(viewport) {\n  if (!isViewportGlobe(viewport)) {\n    return null;\n  }\n\n  const viewportGlobeCenter = /** @type {GeoJSON.Position} */ (getViewportGlobeCenter(viewport));\n  const viewportGlobeRadius = Math.max(\n    distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2, 0])),\n    distance(viewportGlobeCenter, viewport.unproject([0, viewport.height / 2])),\n    ...(viewport.width > viewport.height ? [\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2 - viewport.height / 4 * 1, viewport.height / 2])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2 - viewport.height / 2 * 1, viewport.height / 2])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2 - viewport.height / 4 * 3, viewport.height / 2])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2 - viewport.height, viewport.height / 2])),\n    ] : [\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2, viewport.height / 2 - viewport.width / 4 * 1])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2, viewport.height / 2 - viewport.width / 2 * 1])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2, viewport.height / 2 - viewport.width / 4 * 3])),\n      distance(viewportGlobeCenter, viewport.unproject([viewport.width / 2, viewport.height / 2 - viewport.width])),\n    ])\n  );\n  return viewportGlobeRadius;\n}\n\n/**\n * @param {Viewport} viewport \n * @returns {GeoJSON.BBox | null}\n */\nexport function getViewportBounds(viewport) {\n  return !isViewportGlobe(viewport) ? wrapBounds(viewport.getBounds()) : null;\n}","/*\n * Copyright (c) 2021-2023 WeatherLayers.com\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\nexport default `\\\n#version 300 es\n#define SHADER_NAME particle-layer-update-transform-vertex-shader\n\nprecision highp float;\n\nin vec3 sourcePosition;\nout vec3 targetPosition;\n\nuniform bool viewportGlobe;\nuniform vec2 viewportGlobeCenter;\nuniform float viewportGlobeRadius;\nuniform vec4 viewportBounds;\nuniform float viewportZoomChangeFactor;\n\nuniform sampler2D bitmapTexture;\nuniform vec2 imageUnscale;\nuniform vec4 bounds;\n\nuniform float numParticles;\nuniform float maxAge;\nuniform float speedFactor;\n\nuniform float time;\nuniform float seed;\n\nconst vec2 DROP_POSITION = vec2(0);\n\nbool isNaN(float value) {\n  return !(value <= 0. || 0. <= value);\n}\n\n// see https://stackoverflow.com/a/27228836/1823988\nfloat atan2(float y, float x) {\n  return x == 0. ? sign(y) * PI / 2. : atan(y, x);\n}\n\n// see https://github.com/chrisveness/geodesy/blob/master/latlon-spherical.js#L187\nfloat distanceTo(vec2 from, vec2 point) {\n  float y1 = radians(from.y);\n  float x1 = radians(from.x);\n  float y2 = radians(point.y);\n  float x2 = radians(point.x);\n  float dy = y2 - y1;\n  float dx = x2 - x1;\n\n  float a = sin(dy / 2.) * sin(dy / 2.) + cos(y1) * cos(y2) * sin(dx / 2.) * sin(dx / 2.);\n  float c = 2. * atan2(sqrt(a), sqrt(1. - a));\n  float d = EARTH_RADIUS * c;\n\n  return d;\n}\n\n// see https://github.com/chrisveness/geodesy/blob/master/latlon-spherical.js#L360\nvec2 destinationPoint(vec2 from, float dist, float bearing) {\n  float d = dist / EARTH_RADIUS;\n  float r = radians(bearing);\n\n  float y1 = radians(from.y);\n  float x1 = radians(from.x);\n\n  float siny2 = sin(y1) * cos(d) + cos(y1) * sin(d) * cos(r);\n  float y2 = asin(siny2);\n  float y = sin(r) * sin(d) * cos(y1);\n  float x = cos(d) - sin(y1) * siny2;\n  float x2 = x1 + atan2(y, x);\n\n  float lat = degrees(y2);\n  float lon = degrees(x2);\n\n  return vec2(lon, lat);\n}\n\n// longitude wrapping allows rendering in a repeated MapView\nfloat wrapLongitude(float lng) {\n  float wrappedLng = mod(lng + 180., 360.) - 180.;\n  return wrappedLng;\n}\n\nfloat wrapLongitude(float lng, float minLng) {\n  float wrappedLng = wrapLongitude(lng);\n  if (wrappedLng < minLng) {\n    wrappedLng += 360.;\n  }\n  return wrappedLng;\n}\n\nfloat randFloat(vec2 seed) {\n  return fract(sin(dot(seed.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec2 randPoint(vec2 seed) {\n  return vec2(randFloat(seed + 1.3), randFloat(seed + 2.1));\n}\n\nvec2 pointToPosition(vec2 point) {\n  if (viewportGlobe) {\n    point.x += 0.0001; // prevent generating point in the center\n    float dist = sqrt(point.x) * viewportGlobeRadius;\n    float bearing = point.y * 360.;\n    return destinationPoint(viewportGlobeCenter, dist, bearing);\n  } else {\n    vec2 viewportBoundsMin = viewportBounds.xy;\n    vec2 viewportBoundsMax = viewportBounds.zw;\n    return mix(viewportBoundsMin, viewportBoundsMax, point);\n  }\n}\n\nbool isPositionInBounds(vec2 position, vec4 bounds) {\n  vec2 boundsMin = bounds.xy;\n  vec2 boundsMax = bounds.zw;\n  float lng = wrapLongitude(position.x, boundsMin.x);\n  float lat = position.y;\n  return (\n    boundsMin.x <= lng && lng <= boundsMax.x &&\n    boundsMin.y <= lat && lat <= boundsMax.y\n  );\n}\n\nbool isPositionInViewport(vec2 position) {\n  if (viewportGlobe) {\n    return distanceTo(viewportGlobeCenter, position) <= viewportGlobeRadius;\n  } else {\n    return isPositionInBounds(position, viewportBounds);\n  }\n}\n\n// bitmapTexture is in COORDINATE_SYSTEM.LNGLAT\n// no coordinate conversion needed\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\nbool raster_has_values(vec4 values) {\n  if (imageUnscale[0] < imageUnscale[1]) {\n    return values.a == 1.;\n  } else {\n    return !isNaN(values.x);\n  }\n}\n\nvec2 raster_get_values(vec4 color) {\n  if (imageUnscale[0] < imageUnscale[1]) {\n    return mix(vec2(imageUnscale[0]), vec2(imageUnscale[1]), color.xy);\n  } else {\n    return color.xy;\n  }\n}\n\nvoid main() {\n  float particleIndex = mod(float(gl_VertexID), numParticles);\n  float particleAge = floor(float(gl_VertexID) / numParticles);\n\n  // update particles age0\n  // older particles age1-age(N-1) are copied with buffer.copyData\n  if (particleAge > 0.) {\n    return;\n  }\n\n  if (sourcePosition.xy == DROP_POSITION) {\n    // generate random position to prevent converging particles\n    vec2 particleSeed = vec2(particleIndex * seed / numParticles);\n    vec2 point = randPoint(particleSeed);\n    vec2 position = pointToPosition(point);\n    targetPosition.xy = position;\n    targetPosition.x = wrapLongitude(targetPosition.x);\n    return;\n  }\n\n  if (!isPositionInBounds(sourcePosition.xy, bounds)) {\n    // drop out of bounds\n    targetPosition.xy = DROP_POSITION;\n    return;\n  }\n\n  if (!isPositionInViewport(sourcePosition.xy)) {\n    // drop out of viewport\n    targetPosition.xy = DROP_POSITION;\n    return;\n  }\n\n  if (viewportZoomChangeFactor > 1. && mod(particleIndex, viewportZoomChangeFactor) >= 1.) {\n    // drop when zooming out\n    targetPosition.xy = DROP_POSITION;\n    return;\n  }\n\n  if (abs(mod(particleIndex, maxAge + 2.) - mod(time, maxAge + 2.)) < 1.) {\n    // drop by maxAge, +2 because only non-randomized pairs are rendered\n    targetPosition.xy = DROP_POSITION;\n    return;\n  }\n\n  vec2 uv = getUV(sourcePosition.xy);\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  if (!raster_has_values(bitmapColor)) {\n    // drop nodata\n    targetPosition.xy = DROP_POSITION;\n    return;\n  }\n\n  // update position\n  vec2 speed = raster_get_values(bitmapColor) * speedFactor;\n  // float dist = sqrt(speed.x * speed.x + speed.y + speed.y) * 10000.;\n  // float bearing = degrees(-atan2(speed.y, speed.x));\n  // targetPosition.xy = destinationPoint(sourcePosition.xy, dist, bearing);\n  float distortion = cos(radians(sourcePosition.y)); \n  vec2 offset = vec2(speed.x / distortion, speed.y);\n  targetPosition.xy = sourcePosition.xy + offset;\n  targetPosition.x = wrapLongitude(targetPosition.x);\n}\n`;","/*\n * Copyright (c) 2021-2023 WeatherLayers.com\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\nimport {LineLayer} from '@deck.gl/layers';\nimport {isWebGL2, Buffer, Transform} from '@luma.gl/core';\nimport {isViewportGlobe, getViewportGlobeCenter, getViewportGlobeRadius, getViewportBounds} from './utils/viewport.js';\nimport updateTransformVs from './particle-layer-update-transform.vs.glsl';\n\nconst FPS = 30;\n\nconst DEFAULT_COLOR = [255, 255, 255, 255];\n\nconst defaultProps = {\n  ...LineLayer.defaultProps,\n\n  image: {type: 'image', value: null, async: true},\n  imageUnscale: {type: 'array', value: null},\n\n  numParticles: {type: 'number', min: 1, max: 1000000, value: 5000},\n  maxAge: {type: 'number', min: 1, max: 255, value: 100},\n  speedFactor: {type: 'number', min: 0, max: 1, value: 1},\n\n  color: {type: 'color', value: DEFAULT_COLOR},\n  width: {type: 'number', value: 1},\n  animate: true,\n\n  bounds: {type: 'array', value: [-180, -90, 180, 90], compare: true},\n  wrapLongitude: true,\n};\n\nexport default class ParticleLayer extends LineLayer {\n  getShaders() {\n    return {\n      ...super.getShaders(),\n      inject: {\n        'vs:#decl': `\n          varying float drop;\n          const vec2 DROP_POSITION = vec2(0);\n        `,\n        'vs:#main-start': `\n          drop = float(instanceSourcePositions.xy == DROP_POSITION || instanceTargetPositions.xy == DROP_POSITION);\n        `,\n        'fs:#decl': `\n          varying float drop;\n        `,\n        'fs:#main-start': `\n          if (drop > 0.5) discard;\n        `,\n      },\n    };\n  }\n\n  initializeState() {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      throw new Error('WebGL 2 is required');\n    }\n\n    super.initializeState({});\n\n    this._setupTransformFeedback();\n\n    const attributeManager = this.getAttributeManager();\n    attributeManager.remove(['instanceSourcePositions', 'instanceTargetPositions', 'instanceColors', 'instanceWidths']);\n  }\n\n  updateState({props, oldProps, changeFlags}) {\n    const {numParticles, maxAge, color, width} = props;\n\n    super.updateState({props, oldProps, changeFlags});\n\n    if (!numParticles || !maxAge || !width) {\n      this._deleteTransformFeedback();\n      return;\n    }\n\n    if (\n      numParticles !== oldProps.numParticles ||\n      maxAge !== oldProps.maxAge ||\n      color[0] !== oldProps.color[0] ||\n      color[1] !== oldProps.color[1] ||\n      color[2] !== oldProps.color[2] ||\n      color[3] !== oldProps.color[3] ||\n      width !== oldProps.width\n    ) {\n      this._setupTransformFeedback();\n    }\n  }\n\n  finalizeState() {\n    this._deleteTransformFeedback();\n\n    super.finalizeState();\n  }\n\n  draw({uniforms}) {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      return;\n    }\n\n    const {initialized} = this.state;\n    if (!initialized) {\n      return;\n    }\n\n    const {animate} = this.props;\n    const {sourcePositions, targetPositions, sourcePositions64Low, targetPositions64Low, colors, widths, model} = this.state;\n\n    model.setAttributes({\n      instanceSourcePositions: sourcePositions,\n      instanceTargetPositions: targetPositions,\n      instanceSourcePositions64Low: sourcePositions64Low,\n      instanceTargetPositions64Low: targetPositions64Low,\n      instanceColors: colors,\n      instanceWidths: widths,\n    });\n\n    super.draw({uniforms});\n\n    if (animate) {\n      this.requestStep();\n    }\n  }\n\n  _setupTransformFeedback() {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      return;\n    }\n\n    const {initialized} = this.state;\n    if (initialized) {\n      this._deleteTransformFeedback();\n    }\n\n    const {numParticles, maxAge, color, width} = this.props;\n\n    // sourcePositions/targetPositions buffer layout:\n    // |          age0         |          age1         |          age2         |...|          ageN         |\n    // |pos1,pos2,pos3,...,posN|pos1,pos2,pos3,...,posN|pos1,pos2,pos3,...,posN|...|pos1,pos2,pos3,...,posN|\n    const numInstances = numParticles * maxAge;\n    const numAgedInstances = numParticles * (maxAge - 1);\n    const sourcePositions = new Buffer(gl, new Float32Array(numInstances * 3));\n    const targetPositions = new Buffer(gl, new Float32Array(numInstances * 3));\n    const sourcePositions64Low = new Float32Array([0, 0, 0]); // constant attribute\n    const targetPositions64Low = new Float32Array([0, 0, 0]); // constant attribute\n    const colors = new Buffer(gl, new Float32Array(new Array(numInstances).fill(undefined).map((_, i) => {\n      const age = Math.floor(i / numParticles);\n      return [color[0], color[1], color[2], (color[3] ?? 255) * (1 - age / maxAge)].map(d => d / 255);\n    }).flat()));\n    const widths = new Float32Array([width]); // constant attribute\n\n    const transform = new Transform(gl, {\n      sourceBuffers: {\n        sourcePosition: sourcePositions,\n      },\n      feedbackBuffers: {\n        targetPosition: targetPositions,\n      },\n      feedbackMap: {\n        sourcePosition: 'targetPosition',\n      },\n      vs: updateTransformVs,\n      elementCount: numParticles,\n    });\n\n    this.setState({\n      initialized: true,\n      numInstances,\n      numAgedInstances,\n      sourcePositions,\n      targetPositions,\n      sourcePositions64Low,\n      targetPositions64Low,\n      colors,\n      widths,\n      transform,\n    });\n  }\n\n  _runTransformFeedback() {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      return;\n    }\n\n    const {initialized} = this.state;\n    if (!initialized) {\n      return;\n    }\n\n    const {viewport, timeline} = this.context;\n    const {image, imageUnscale, bounds, numParticles, speedFactor, maxAge} = this.props;\n    const {numAgedInstances, transform, previousViewportZoom, previousTime} = this.state;\n    const time = timeline.getTime();\n    if (!image || time === previousTime) {\n      return;\n    }\n\n    // viewport\n    const viewportGlobe = isViewportGlobe(viewport);\n    const viewportGlobeCenter = getViewportGlobeCenter(viewport);\n    const viewportGlobeRadius = getViewportGlobeRadius(viewport);\n    const viewportBounds = getViewportBounds(viewport);\n    const viewportZoomChangeFactor = 2 ** ((previousViewportZoom - viewport.zoom) * 4);\n\n    // speed factor for current zoom level\n    const currentSpeedFactor = speedFactor / 2 ** (viewport.zoom + 7);\n\n    // update particles age0\n    const uniforms = {\n      viewportGlobe,\n      viewportGlobeCenter: viewportGlobeCenter || [0, 0],\n      viewportGlobeRadius: viewportGlobeRadius || 0,\n      viewportBounds: viewportBounds || [0, 0, 0, 0],\n      viewportZoomChangeFactor: viewportZoomChangeFactor || 0,\n\n      bitmapTexture: image,\n      imageUnscale: imageUnscale || [0, 0],\n      bounds,\n      numParticles,\n      maxAge,\n      speedFactor: currentSpeedFactor,\n\n      time,\n      seed: Math.random(),\n    };\n    transform.run({uniforms});\n\n    // update particles age1-age(N-1)\n    // copy age0-age(N-2) sourcePositions to age1-age(N-1) targetPositions\n    const sourcePositions = transform.bufferTransform.bindings[transform.bufferTransform.currentIndex].sourceBuffers.sourcePosition;\n    const targetPositions = transform.bufferTransform.bindings[transform.bufferTransform.currentIndex].feedbackBuffers.targetPosition;\n    sourcePositions.copyData({\n      sourceBuffer: targetPositions,\n      readOffset: 0,\n      writeOffset: numParticles * 4 * 3,\n      size: numAgedInstances * 4 * 3,\n    });\n\n    transform.swap();\n\n    // const {sourcePositions, targetPositions} = this.state;\n    // console.log(uniforms, sourcePositions.getData().slice(0, 6), targetPositions.getData().slice(0, 6));\n\n    this.state.previousViewportZoom = viewport.zoom;\n    this.state.previousTime = time;\n  }\n\n  _resetTransformFeedback() {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      return;\n    }\n\n    const {initialized} = this.state;\n    if (!initialized) {\n      return;\n    }\n\n    const {numInstances, sourcePositions, targetPositions} = this.state;\n\n    sourcePositions.subData({data: new Float32Array(numInstances * 3)});\n    targetPositions.subData({data: new Float32Array(numInstances * 3)});\n  }\n\n  _deleteTransformFeedback() {\n    const {gl} = this.context;\n    if (!isWebGL2(gl)) {\n      return;\n    }\n\n    const {initialized} = this.state;\n    if (!initialized) {\n      return;\n    }\n\n    const {sourcePositions, targetPositions, colors, transform} = this.state;\n\n    sourcePositions.delete();\n    targetPositions.delete();\n    colors.delete();\n    transform.delete();\n\n    this.setState({\n      initialized: false,\n      sourcePositions: undefined,\n      targetPositions: undefined,\n      sourcePositions64Low: undefined,\n      targetPositions64Low: undefined,\n      colors: undefined,\n      widths: undefined,\n      transform: undefined,\n    });\n  }\n\n  requestStep() {\n    const {stepRequested} = this.state;\n    if (stepRequested) {\n      return;\n    }\n\n    this.state.stepRequested = true;\n    setTimeout(() => {\n      this.step();\n      this.state.stepRequested = false;\n    }, 1000 / FPS);\n  }\n\n  step() {\n    this._runTransformFeedback();\n\n    this.setNeedsRedraw();\n  }\n\n  clear() {\n    this._resetTransformFeedback();\n\n    this.setNeedsRedraw();\n  }\n}\n\nParticleLayer.layerName = 'ParticleLayer';\nParticleLayer.defaultProps = defaultProps;\n"],"names":["_classCallCheck","a","n","TypeError","_typeof","o","Symbol","iterator","constructor","prototype","toPrimitive","t","r","e","i","call","String","Number","toPropertyKey","_defineProperties","length","enumerable","configurable","writable","Object","defineProperty","key","_createClass","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","assertThisInitialized","_getPrototypeOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_superPropBase","hasOwnProperty","_get","Reflect","get","p","superPropBase","getOwnPropertyDescriptor","arguments","value","apply","_setPrototypeOf","_inherits","create","_defineProperty","_arrayLikeToArray","Array","_arrayWithoutHoles","isArray","arrayLikeToArray","_iterableToArray","from","_unsupportedIterableToArray","toString","slice","name","test","_nonIterableSpread","_toConsumableArray","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","DEFAULT_RADIUS","distance","start","destination","geodesyDistance","mod","x","y","wrapLongitude","lng","minLng","undefined","wrappedLng","wrapBounds","bounds","maxLng","minLat","Math","max","maxLat","min","mercatorBounds","isViewportGlobe","viewport","resolution","getViewportGlobeCenter","longitude","latitude","getViewportGlobeRadius","viewportGlobeCenter","viewportGlobeRadius","unproject","width","height","concat","getViewportBounds","getBounds","FPS","DEFAULT_COLOR","defaultProps","_objectSpread","LineLayer","image","type","async","imageUnscale","numParticles","maxAge","speedFactor","color","animate","compare","ParticleLayer","_LineLayer","_callSuper","getShaders","inject","initializeState","gl","context","isWebGL2","Error","_setupTransformFeedback","attributeManager","getAttributeManager","remove","updateState","_ref","props","oldProps","changeFlags","_deleteTransformFeedback","finalizeState","draw","_ref2","uniforms","initialized","state","_this$state","sourcePositions","targetPositions","sourcePositions64Low","targetPositions64Low","colors","widths","model","setAttributes","instanceSourcePositions","instanceTargetPositions","instanceSourcePositions64Low","instanceTargetPositions64Low","instanceColors","instanceWidths","requestStep","_this$props","numInstances","numAgedInstances","Buffer","Float32Array","fill","map","_","_color$","age","floor","d","flat","transform","Transform","sourceBuffers","sourcePosition","feedbackBuffers","targetPosition","feedbackMap","vs","updateTransformVs","elementCount","setState","_runTransformFeedback","_this$context","timeline","_this$props2","_this$state2","previousViewportZoom","previousTime","time","getTime","viewportGlobe","viewportBounds","viewportZoomChangeFactor","pow","zoom","currentSpeedFactor","bitmapTexture","seed","random","run","bufferTransform","bindings","currentIndex","copyData","sourceBuffer","readOffset","writeOffset","size","swap","_resetTransformFeedback","_this$state3","subData","data","_this$state4","_this","stepRequested","setTimeout","step","setNeedsRedraw","clear","layerName"],"mappings":"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"}